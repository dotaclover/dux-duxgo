import{j as e}from"./vendor-map-CE4d5YIX.js";import{A as C,z as O}from"./vendor-refine-YO-08iKi.js";import{x as P}from"./modulepreload-polyfill-EV7mDuCf.js";import{r as T}from"./vendor-react-PEuRF1c_.js";import"./vendor-echarts-MrFpn7eE.js";import"./vendor-lib-BVPxUOb1.js";import{F as S,a as u}from"./page-DEK3AXMZ.js";import"./vendor-tinymce-D1FYj-JL.js";import{C as E}from"./cascader-Csfpe9Pf.js";import{u as G}from"./index-DBcwkRI-.js";import{I as y,a5 as b,j as f,S as j,Z as k,B as K,t as N,K as R,F as v,ad as $,R as o}from"./vendor-tdesign-Bkc5HfQ6.js";import"./vendor-markdown-DBx9sqkl.js";import"./editor-Dg0x6Ku5.js";import"./useSelect-CPLYU2d6.js";import"./useUpload-DxbIJWgS.js";import"./uploadFile-YsBOGyhm.js";import"./manage-BKyw5xWS.js";const q=({type:l,data:d,onSave:a})=>{const[m,r]=T.useState(!1),[x]=v.useForm(),g=C();return e.jsxs(e.Fragment,{children:[e.jsx(K,{icon:e.jsx(f,{name:"setting"}),variant:"outline",onClick:()=>r(!0),disabled:!(l!=null&&l.ParamsRender)}),e.jsx($,{header:g("magic.setting",{ns:"extend"}),visible:m,onClose:()=>r(!1),closeOnOverlayClick:!1,onConfirm:()=>{a(x.getFieldsValue(!0)),r(!1)},destroyOnClose:!0,children:e.jsx(v,{form:x,labelAlign:"top",initialData:d,children:(l==null?void 0:l.ParamsRender)&&e.jsx(l.ParamsRender,{form:x})})})]})},h=(l,d)=>{const a=d.split("-"),m=(r,x)=>{const g=x.shift(),c=r[g];return x.length?m(c.child,x):{list:r,index:g,item:c}};return m(l,a)},F=(l,d="")=>l.map((a,m)=>{var r;return a.key=`${d}${d?"-":""}${m}`,(r=a.child)!=null&&r.length&&(a.child=F(a.child,a.key)),a}),A=({...l})=>{const[d,a]=P(l,{defaultValue:[]}),[m,r]=T.useState([]),{items:x,itemsIndex:g}=G(),c=C(),I=[{colKey:"label",title:c("magic.column.label",{ns:"extend"}),minWidth:400,className:"magic-td",cell:({row:t})=>e.jsx("div",{className:"magic-td-input",children:e.jsx(y,{className:"",value:t.label,onChange:s=>{a(i=>{const{item:n}=h(i,t.key);return n.label=s,[...i]})}})})},{colKey:"name",title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:c("magic.column.name",{ns:"extend"})}),e.jsx(b,{content:c("magic.column.nameTooltip",{ns:"extend"}),children:e.jsx(f,{name:"help-circle"})})]}),minWidth:150,cell:({row:t})=>e.jsx(y,{value:t.name,onChange:s=>{a(i=>{const{item:n}=h(i,t.key);return n.name=s,[...i]})}})},{colKey:"type",title:c("magic.column.type",{ns:"extend"}),width:300,cell:({row:t})=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{onChange:s=>{a(i=>{const{item:n}=h(i,t.key);return n.type!=s&&(n.setting={}),g[""+s].child||(n.child=[]),n.type=s,[...i]})},value:t.type,children:x.map((s,i)=>e.jsx(j.Option,{value:s.name,children:s.label},i))}),e.jsx(q,{data:t.setting,onSave:s=>{a(i=>{const{item:n}=h(i,t.key);return n.setting=s,[...i]})},type:x.find(s=>{if(s.name==t.type)return s})})]})},{width:100,align:"center",colKey:"required",title:c("magic.column.required",{ns:"extend"}),cell:({row:t})=>e.jsx(k,{checked:t.required||!1,onChange:s=>{a(i=>{const{item:n}=h(i,t.key);return n.required=s,[...i]})}})},{width:100,align:"center",colKey:"list",title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:c("magic.column.list",{ns:"extend"})}),e.jsx(b,{content:c("magic.column.listTooltip",{ns:"extend"}),children:e.jsx(f,{name:"help-circle"})})]}),cell:({row:t})=>e.jsx(k,{checked:t.list||!1,onChange:s=>{a(i=>{const{item:n}=h(i,t.key);return n.list=s,[...i]})}})},{width:100,align:"center",colKey:"search",title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:c("magic.column.search",{ns:"extend"})}),e.jsx(b,{content:c("magic.column.searchTooltip",{ns:"extend"}),children:e.jsx(f,{name:"help-circle"})})]}),cell:({row:t})=>e.jsx(k,{checked:t.search||!1,onChange:s=>{a(i=>{const{item:n}=h(i,t.key);return n.search=s,[...i]})}})},{width:130,align:"center",colKey:"external",title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:c("magic.column.external",{ns:"extend"})}),e.jsx(b,{content:c("magic.column.externalTooltip",{ns:"extend"}),children:e.jsx(f,{name:"help-circle"})})]}),cell:({row:t})=>e.jsxs(j,{value:t.external||"empty",onChange:s=>{a(i=>{const{item:n}=h(i,t.key);return n.external=s,[...i]})},children:[e.jsx(j.Option,{value:"empty",children:c("magic.external.empty",{ns:"extend"})}),e.jsx(j.Option,{value:"read",children:c("magic.external.read",{ns:"extend"})}),e.jsx(j.Option,{value:"write",children:c("magic.external.write",{ns:"extend"})}),e.jsx(j.Option,{value:"readWrite",children:c("magic.external.readWrite",{ns:"extend"})})]})},{colKey:"action",fixed:"right",width:150,title:e.jsxs("div",{className:"flex justify-between",children:[c("table.actions")," ",e.jsx(K,{icon:e.jsx(f,{name:"plus"}),size:"small",variant:"outline",onClick:()=>{a(t=>[...t||[],{type:"text",setting:{},key:`${(t==null?void 0:t.length)||0}`}])}})]}),cell:({row:t})=>{const s=g[t.type];return e.jsxs("div",{className:"flex justify-center gap-4",children:[s.child&&e.jsx(N,{theme:"primary",onClick:()=>{a(i=>{const{item:n}=h(i,t.key);return n.child=n.child||[],typeof s.child=="object"&&s.child.max&&n.child.length>=s.child.max?i:(n.child.length===0&&r(p=>p.includes(t.key)?p:(p.push(t.key),[...p])),n.child.push({type:"text",setting:{},key:`${t.key}-${n.child.length}`}),[...i])})},children:c("buttons.create")}),e.jsx(N,{theme:"danger",onClick:()=>{a(i=>{const{list:n,index:p}=h(i,t.key);return n.splice(p,1),F(i)})},children:c("buttons.delete")})]})}}];return e.jsx(R,{rowKey:"key",columns:I,data:d||[],bordered:!0,tree:{childrenKey:"child",treeNodeColumnIndex:0},expandedTreeNodes:m,onExpandedTreeNodesChange:t=>r(t)})},le=()=>{const l=C(),{id:d}=O();return e.jsxs(S,{formProps:{labelAlign:"top"},back:!0,id:d,children:[e.jsx(u,{name:"group_id",label:l("tools.magic.fields.group"),help:l("tools.magic.help.group"),children:e.jsx(E,{checkStrictly:!0,url:"tools.magicGroup",keys:{label:"label",value:"id"},placeholder:l("tools.magic.placeholder.group"),clearable:!0})}),e.jsx(u,{name:"label",label:l("tools.magic.fields.label"),help:l("tools.magic.fields.labelDesc"),children:e.jsx(y,{placeholder:l("tools.magic.validate.label")})}),e.jsx(u,{name:"name",label:l("tools.magic.fields.name"),help:l("tools.magic.fields.nameDesc"),children:e.jsx(y,{placeholder:l("tools.magic.validate.name")})}),e.jsx(u,{name:"page",label:l("tools.magic.fields.option"),help:l("tools.magic.fields.optionDesc"),initialData:0,children:e.jsxs(o.Group,{children:[e.jsx(o,{value:0,children:l("tools.magic.fields.modal")}),e.jsx(o,{value:1,children:l("tools.magic.fields.page")})]})}),e.jsx(u,{name:"type",label:l("tools.magic.fields.type"),help:l("tools.magic.fields.typeDesc"),initialData:"common",children:e.jsxs(o.Group,{children:[e.jsx(o,{value:"common",children:l("tools.magic.fields.list")}),e.jsx(o,{value:"pages",children:l("tools.magic.fields.pages")}),e.jsx(o,{value:"tree",children:l("tools.magic.fields.tree")}),e.jsx(o,{value:"page",children:l("tools.magic.fields.page")})]})}),e.jsx(v.FormItem,{shouldUpdate:(a,m)=>a.type!==m.type,children:({getFieldValue:a})=>a("type")==="tree"?e.jsx(u,{name:"tree_label",label:l("tools.magic.fields.treeLabel"),help:l("tools.magic.fields.treeLabelDesc"),children:e.jsx(y,{})}):e.jsx(e.Fragment,{})}),e.jsx(u,{name:"inline",label:l("tools.magic.fields.affiliate"),help:l("tools.magic.fields.affiliateDesc"),initialData:0,children:e.jsxs(o.Group,{children:[e.jsx(o,{value:0,children:l("tools.magic.fields.independentType")}),e.jsx(o,{value:1,children:l("tools.magic.fields.inlineType")})]})}),e.jsx(u,{name:"external",label:l("tools.magic.fields.external"),help:l("tools.magic.fields.externalDesc"),initialData:0,children:e.jsx(k.Group,{options:[{value:"read",label:l("tools.magic.external.read")},{value:"create",label:l("tools.magic.external.create")},{value:"edit",label:l("tools.magic.external.edit")}]})}),e.jsx(u,{name:"fields",label:l("tools.magic.fields.fields"),help:l("tools.magic.fields.fieldsDesc"),children:e.jsx(A,{})})]})};export{le as default};
