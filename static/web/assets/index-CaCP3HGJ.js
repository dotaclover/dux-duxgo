const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/speed-GFqHg5mw.js","assets/vendor-map-CE4d5YIX.js","assets/vendor-react-PEuRF1c_.js","assets/vendor-tdesign-Bkc5HfQ6.js","assets/modulepreload-polyfill-EV7mDuCf.js","assets/vendor-echarts-MrFpn7eE.js","assets/vendor-refine-YO-08iKi.js","assets/vendor-lib-BVPxUOb1.js","assets/vendor-tinymce-D1FYj-JL.js","assets/vendor-markdown-DBx9sqkl.js"])))=>i.map(i=>d[i]);
import{_ as H}from"./vendor-markdown-DBx9sqkl.js";import{j as t}from"./vendor-map-CE4d5YIX.js";import{r as i}from"./vendor-react-PEuRF1c_.js";import{A as J,ao as P,O as G}from"./vendor-refine-YO-08iKi.js";import{q as W,s as V,t as q,v as X,M as Q,w as U}from"./modulepreload-polyfill-EV7mDuCf.js";import{b as Y,E as Z,_ as K}from"./vendor-echarts-MrFpn7eE.js";import"./vendor-lib-BVPxUOb1.js";import"./vendor-tinymce-D1FYj-JL.js";import{N as $,t as ee,B as te,T as se,O as ne}from"./vendor-tdesign-Bkc5HfQ6.js";const re=({single:r,options:s,min:c})=>{const n=W(v=>v.dark),o=i.useMemo(()=>{const v=s||[];let x={grid:{top:30,right:30,left:30,bottom:30}};return c&&(x={grid:{top:5,right:5,bottom:5,left:5,show:!1},xAxis:{show:!1},yAxis:{show:!1}}),V.all([x,...v])},[c,s]);return t.jsx(Z,{option:o,theme:n?r?"dark-single":"dark":r?"light-single":"light",style:{height:"100%",width:"100%"},opts:{renderer:"svg"}})},ae=({name:r,map:s,data:c,min:n,params:o,options:v,single:x})=>{const C=W(h=>h.dark),[y,L]=i.useState(!0);i.useEffect(()=>{fetch(`/maps/${s}.json`).then(h=>h.json()).then(h=>{Y("china",h),L(!1)})},[]);const O=i.useMemo(()=>({visualMap:{show:!1,min:0,max:5e3,realtime:!1,calculable:!0,...o},tooltip:{trigger:"item",showDelay:0,transitionDuration:.2},series:[{name:r,type:"map",map:s,label:{show:!1},itemStyle:{areaColor:C?"#181818":"#f2f3ff"},data:c,zoom:1.2}]}),[C,c,s]);return y?t.jsx(t.Fragment,{}):t.jsx(re,{options:[O,v||{}],min:n,single:x})};function R(r){var s=i.useRef(r);return s.current=r,s}var le=function(r){var s=R(r);i.useEffect(function(){return function(){s.current()}},[])},ie=function(r,s,c){c===void 0&&(c={});var n=q(r),o=i.useRef(null),v=i.useCallback(function(){o.current&&clearInterval(o.current)},[]);return i.useEffect(function(){return c.immediate&&n(),o.current=setInterval(n,s),v},[s,c.immediate]),v},N;(function(r){r[r.Connecting=0]="Connecting",r[r.Open=1]="Open",r[r.Closing=2]="Closing",r[r.Closed=3]="Closed"})(N||(N={}));function oe(r,s){s===void 0&&(s={});var c=s.reconnectLimit,n=c===void 0?3:c,o=s.reconnectInterval,v=o===void 0?3*1e3:o,x=s.manual,C=x===void 0?!1:x,y=s.onOpen,L=s.onClose,O=s.onMessage,h=s.onError,D=s.protocols,M=R(y),j=R(L),S=R(O),_=R(h),z=i.useRef(0),b=i.useRef(),d=i.useRef(),B=K(i.useState(),2),E=B[0],I=B[1],w=K(i.useState(N.Closed),2),F=w[0],T=w[1],e=function(){var a;z.current<n&&((a=d.current)===null||a===void 0?void 0:a.readyState)!==N.Open&&(b.current&&clearTimeout(b.current),b.current=setTimeout(function(){l(),z.current++},v))},l=function(){b.current&&clearTimeout(b.current),d.current&&d.current.close();var a=new WebSocket(r,D);T(N.Connecting),a.onerror=function(p){var f;d.current===a&&(e(),(f=_.current)===null||f===void 0||f.call(_,p,a),T(a.readyState||N.Closed))},a.onopen=function(p){var f;d.current===a&&((f=M.current)===null||f===void 0||f.call(M,p,a),z.current=0,T(a.readyState||N.Open))},a.onmessage=function(p){var f;d.current===a&&((f=S.current)===null||f===void 0||f.call(S,p,a),I(p))},a.onclose=function(p){var f;(f=j.current)===null||f===void 0||f.call(j,p,a),d.current===a&&e(),(!d.current||d.current===a)&&T(a.readyState||N.Closed)},d.current=a},u=function(a){var p;if(F===N.Open)(p=d.current)===null||p===void 0||p.send(a);else throw new Error("WebSocket disconnected")},m=function(){z.current=0,l()},g=function(){var a;b.current&&clearTimeout(b.current),z.current=n,(a=d.current)===null||a===void 0||a.close(),d.current=void 0};return i.useEffect(function(){!C&&r&&m()},[r,C]),le(function(){g()}),{latestMessage:E,sendMessage:q(u),connect:q(m),disconnect:q(g),readyState:F,webSocketIns:d.current}}const he=()=>{const{request:r}=X(),s=J(),{data:c}=P({url:"system/total",method:"get",meta:{params:{}}}),n=c==null?void 0:c.data,[o,v]=i.useState({}),[x,C]=i.useState(!0);ie(()=>{r("system/total/hardware","get").then(e=>{C(!1),v(e.data||[])})},5e3);const[y,L]=i.useState(""),[O,h]=i.useState(!1),[D,M]=i.useState(!1),[j,S]=i.useState([]),[_,z]=i.useState([]),{mutate:b}=G(),{readyState:d,sendMessage:B,latestMessage:E,disconnect:I,connect:w}=oe("wss://data.cesu.net/v1/ws",{manual:!0,reconnectLimit:0});i.useEffect(()=>{y?(O&&I(),setTimeout(()=>{S([]),w()},500)):I()},[y]),i.useEffect(()=>{y&&(d==1&&(h(!0),B(JSON.stringify({taskId:y}))),d==3&&h(!1))},[d,y]),i.useEffect(()=>{if(!E)return;M(!1);const e=JSON.parse(E==null?void 0:E.data);(e==null?void 0:e.nid)!=0&&(e==null?void 0:e.nid)!=0&&((e==null?void 0:e.code)==200||(e==null?void 0:e.code)==500||(e==null?void 0:e.code)==400)&&S(l=>{var u,m;return[...l,{nid:e==null?void 0:e.nid,time:(u=e==null?void 0:e.data)!=null&&u.success&&((m=e==null?void 0:e.data)!=null&&m.allTime)?Number(e.data.allTime):void 0,info:_==null?void 0:_.find(g=>(g==null?void 0:g.nid)==(e==null?void 0:e.nid))}]})},[E,_]);const F=i.useMemo(()=>(j==null?void 0:j.map(e=>{var l,u,m,g;if((l=e==null?void 0:e.info)!=null&&l.china_province)return{name:(u=e==null?void 0:e.info)==null?void 0:u.province,value:e!=null&&e.time?(g=e==null?void 0:(m=e.time).toFixed)==null?void 0:g.call(m,2):1e3}}).filter(e=>!!e))||[],[j]),T=(e,l,u)=>{M(!0),b({url:"system/total/speed",method:"post",values:{net:e,token:u,url:l}},{onSuccess(m){var g,a;L((g=m.data)==null?void 0:g.taskId),z((a=m.data)==null?void 0:a.nodes)},onError(){M(!1)}})};return t.jsx(Q,{children:t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsx($,{title:t.jsx("div",{className:"flex items-center gap-2",children:s("system.total.general.title")}),headerBordered:!0,children:t.jsxs("div",{className:"grid grid-cols-1 gap-4 2xl:grid-cols-4 md:grid-cols-2",children:[t.jsx(A,{isLoading:x,title:s("system.total.general.cpu"),value:Number(o==null?void 0:o.cpu),unit:"%"}),t.jsx(A,{isLoading:x,title:s("system.total.general.mem"),value:Number(o==null?void 0:o.mem),unit:"%"}),t.jsx(A,{isLoading:x,title:s("system.total.general.thread"),value:Number(o==null?void 0:o.thread)}),t.jsx(A,{isLoading:x,title:s("system.total.general.goroutine"),value:(o==null?void 0:o.goroutine)||0})]})}),t.jsx($,{title:s("system.total.env.title"),headerBordered:!0,children:t.jsxs("div",{className:"row-4 grid grid-cols-1 w-full gap-4 gap-4 2xl:grid-cols-4 md:grid-cols-2",children:[t.jsx(k,{title:s("system.total.env.go"),value:(n==null?void 0:n.go)||"-",icon:t.jsx("div",{className:"size-12 flex flex-none items-center justify-center rounded-full bg-brand-2 p-3 text-brand",children:t.jsx("div",{className:"i-tabler:brand-golang size-8"})})}),t.jsx(k,{title:s("system.total.env.os"),value:(n==null?void 0:n.os)||"-",icon:t.jsx("div",{className:"size-12 flex flex-none items-center justify-center rounded-full bg-success-2 p-3 text-success",children:t.jsx("div",{className:"i-tabler:server size-8"})})}),t.jsx(k,{title:s("system.total.env.boot"),value:(n==null?void 0:n.boot_time)||"-",icon:t.jsx("div",{className:"size-12 flex flex-none items-center justify-center rounded-full bg-error-2 p-3 text-error",children:t.jsx("div",{className:"i-tabler:bolt size-8"})})}),t.jsx(k,{title:s("system.total.env.time"),value:"UTC "+(n==null?void 0:n.time),icon:t.jsx("div",{className:"size-12 flex flex-none items-center justify-center rounded-full bg-warning-2 p-3 text-warning",children:t.jsx("div",{className:"i-tabler:calendar-time size-8"})})}),t.jsx(k,{title:s("system.total.env.log_size"),value:n==null?void 0:n.log_size,icon:t.jsx("div",{className:"size-12 flex flex-none items-center justify-center rounded-full bg-pink-1 p-3 text-pink-6 dark:bg-pink-9/50 dark:text-pink-7",children:t.jsx("div",{className:"i-tabler:logs size-8"})})}),t.jsx(k,{title:s("system.total.env.event"),value:n==null?void 0:n.event,icon:t.jsx("div",{className:"size-12 flex flex-none items-center justify-center rounded-full bg-purple-1 p-3 p-3 text-purple-6 dark:bg-purple-9/50 dark:text-purple-7",children:t.jsx("div",{className:"i-tabler:christmas-tree size-8"})})}),t.jsx(k,{title:s("system.total.env.schedule"),value:n==null?void 0:n.schedule,icon:t.jsx("div",{className:"size-12 flex flex-none items-center justify-center rounded-full bg-teal-1 p-3 p-3 text-teal-6 dark:bg-teal-9/50 dark:text-teal-7",children:t.jsx("div",{className:"i-tabler:calendar-event size-8"})})}),t.jsx(k,{title:s("system.total.env.queue"),value:n==null?void 0:n.queue,icon:t.jsx("div",{className:"size-12 flex flex-none items-center justify-center rounded-full bg-yellow-2 p-3 p-3 text-yellow-6 dark:bg-yellow-9/50 dark:text-yellow-7",children:t.jsx("div",{className:"i-tabler:manual-gearbox size-8"})})})]})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx($,{title:s("system.total.speed.title"),description:t.jsxs(t.Fragment,{children:[s("system.total.speed.desc"),t.jsx(ee,{href:"https://www.cesu.net/",theme:"primary",target:"_blank",children:s("system.total.speed.view")})]}),headerBordered:!0,actions:t.jsx("div",{children:t.jsx(te,{variant:"outline",onClick:()=>{U.open({title:"站点测速",component:()=>H(()=>import("./speed-GFqHg5mw.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),componentProps:{onSpeedTest:T}})},loading:D,children:s("system.total.speed.start")})}),children:t.jsx("div",{className:"h-100 w-full",children:t.jsx(ae,{name:s("system.total.speed.speed"),params:{min:0,max:10},options:{tooltip:{trigger:"item",formatter:({seriesName:e,value:l})=>{var u;return`${e} ${l<1e3?((u=l==null?void 0:l.toFixed)==null?void 0:u.call(l,2))+"s":s("system.total.speed.timeout")}`}}},data:F,map:"china"})})}),t.jsx($,{title:s("system.total.area.title"),headerBordered:!0,children:t.jsx(se,{data:j,rowKey:"nid",maxHeight:420,columns:[{title:s("system.total.area.area"),colKey:"province",cell:({row:e})=>{var l,u;return`${((l=e==null?void 0:e.info)==null?void 0:l.province)||""}${(u=e==null?void 0:e.info)==null?void 0:u.city}`}},{title:s("system.total.area.line"),colKey:"type",cell:({row:e})=>{var l;return(l=e==null?void 0:e.info)==null?void 0:l.type}},{title:s("system.total.area.time"),colKey:"time",sortType:"all",width:200,sorter:!0,cell:({row:e})=>{var l,u;return(e==null?void 0:e.time)<1e3?`${(u=(l=e.time).toFixed)==null?void 0:u.call(l,2)}s`:s("system.total.speed.timeout")}}],onSortChange:e=>{if(!e||!(e!=null&&e.sortBy)){S([...j]);return}const l=j.concat().sort((u,m)=>e.descending?m[e.sortBy]-u[e.sortBy]:u[e.sortBy]-m[e.sortBy]);S([...l])}})})]})]})})},A=({isLoading:r,title:s,value:c,unit:n})=>t.jsx("div",{className:"flex items-start gap-4",children:t.jsx(ne,{title:t.jsx("div",{children:s}),value:c,loading:r,unit:n})}),k=({isLoading:r,title:s,value:c,icon:n})=>t.jsxs("div",{className:"flex gap-4 rounded p-2",children:[n,t.jsxs("div",{className:"flex flex-1 flex-col",children:[t.jsx("div",{className:"text-placeholder",children:s}),t.jsx("div",{className:"text-base font-bold",children:r?"-":c})]})]});export{he as default};
